#!/usr/local/bin/perl 
# -*- perl -*-

use IO::File;

use strict;
use warnings;

use vars qw($VERSION);
$VERSION = 0.1;

use Getopt::Long;

my $debug  = 1;    # 0: quiet, 1: normal, 2: verbose

sub usage () {
    <<EOF;
usage: $0 [--debug={0..2}] [options] city

--debug=0..2	  debug option
EOF
}

my $lang;
my $coord;

GetOptions(
    "debug=i" => \$debug,
    "lang"  => \$lang,
    "coord"  => \$coord,
) or die usage;

usage if !@ARGV;

my $city = shift;
my $db = $0;

$db =~ s,/+[^/]+$,/../misc/cities.csv,;
my %hash;

my $fh = new IO::File $db, "r" or die "open: $!\n";
while(<$fh>) {
	next if /^\s*#/;
	chomp;

	my ($city, $name, $lang, $area, $coords) = split(/:/);
	$hash { $city } = { city => $city,
			name => $name,
			lang => $lang,
			area => $area,
			coords => $coords };
}
close $fh;

if (exists $hash{$city} ) {
	if ($lang) {
		print $hash{$city}->{lang}, "\n";
	} elsif ($coord) {
		print $hash{$city}->{coord}, "\n";
	} else {
		warn "unknown directive\n";
		&usage;
		
	}
} else {
	warn "Unknown city: $city\n";
	&usage;
}
