#!/usr/local/bin/perl

use HTML::TagCloud;
use Getopt::Long;
use strict;
use warnings;

my $debug = 1;      # 0: quiet, 1: normal, 2: verbose
my $lang  = 'de';
my $level = 12;

sub usage () {
    <<EOF;
usage: $0 [--debug={0..2}] [--level=number ] [ --lang=lang ] < population.csv

--debug=0..2    debug option
--lang=		de | en
--level=16
EOF
}

# several tagclouds on one page
sub id2class {
    my $data = shift;
    $data =~ s,<div id="htmltagcloud">,<div class="htmltagcloud">,;
    return $data;
}

GetOptions(
    "debug=i" => \$debug,
    "lang=s"  => \$lang,
    "level=i" => \$level,
) or die usage;

my $cloud = HTML::TagCloud->new( levels => $level );

my $ext = $lang ne 'de' ? ".$lang.cgi" : '.cgi';

while (<>) {
    chomp;

    my ( $city, $population ) = split(/[:\s]+/);

    $population = 1 if $population <= 0;

    $cloud->add( $city, "cgi/$city$ext", $population );
}

print &id2class( $cloud->html);

