#!/opt/local/bin/perl

use Getopt::Long;
use utf8;

use strict;
use warnings;

sub unicode2ascii {
    my $string = shift;

    my @list;
    my $s;

    # German
    $s = $string;
    $s =~ s/Ä/Ae/g;
    $s =~ s/Ö/Oe/g;
    $s =~ s/Ü/Ue/g;
    $s =~ s/ä/ae/g;
    $s =~ s/ö/oe/g;
    $s =~ s/ü/ue/g;
    $s =~ s/ß/ss/g;
    $s =~ s/é/e/g;
    $s =~ s/è/e/g;
    $s =~ s/á/a/g;

    push( @list, $s ) if $s ne $string;

    # English
    $s = $string;
    $s =~ s/Ä/A/g;
    $s =~ s/Ö/O/g;
    $s =~ s/Ü/U/g;
    $s =~ s/ä/a/g;
    $s =~ s/ö/o/g;
    $s =~ s/ü/u/g;
    $s =~ s/ß/B/g;
    $s =~ s/é/e/g;

    push( @list, $s ) if $s ne $string;

    # return unique list
    my %hash = map { $_ => 1 } @list;
    @list = keys %hash;

    return @list;
}

my $debug    = 0;
my $icharset = 'utf8';
my $help;

my $rc = GetOptions(
    "debug=i"         => \$debug,
    "input-charset=s" => \$icharset,
    "help"            => \$help,
);

binmode( \*STDIN,  ":encoding($icharset)" ) or die "binmode: $!\n";
binmode( \*STDOUT, ":encoding(utf-8)" )     or die "binmode: $!\n";

my %s;
while (<>) {
    if ( /^\s*#/ || /^\(/ ) {
        next;
    }

    chomp;
    my $street = ( split(/\t/) )[0];
    $s{$street} = 1 if $street;
}

foreach my $street ( sort keys %s ) {
    if ( my @strings = unicode2ascii($street) ) {
        foreach my $s (@strings) {
            print $s, "\t", $street, "\n";
        }
    }
    else {
        print "$street\n";
    }
}

