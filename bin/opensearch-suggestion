#!/usr/bin/perl

use Getopt::Long;
use utf8;

use strict;
use warnings;

sub unicode2ascii {
    my $string = shift;

    my @list;
    my $s;

    ############################################
    # German
    $s = $string;

    $s =~ s/Ä/Ae/g;
    $s =~ s/Ö/Oe/g;
    $s =~ s/Ü/Ue/g;
    $s =~ s/ä/ae/g;
    $s =~ s/ö/oe/g;
    $s =~ s/ü/ue/g;
    $s =~ s/ß/ss/g;
    $s =~ s/é/e/g;
    $s =~ s/è/e/g;
    $s =~ s/á/a/g;

    push( @list, $s ) if $s ne $string;

    ############################################
    # English
    $s = $string;

    $s =~ s/Ä/A/g;
    $s =~ s/Ö/O/g;
    $s =~ s/Ü/U/g;
    $s =~ s/ä/a/g;
    $s =~ s/ö/o/g;
    $s =~ s/ü/u/g;
    $s =~ s/ß/B/g;
    $s =~ s/é/e/g;

    push( @list, $s ) if $s ne $string;

    ############################################
    # slavic languages (polish, croatian, czech)
    $s = $string;

    $s =~ s,á,a,g;
    $s =~ s,ó,o,g;
    $s =~ s,Ć,C,g;
    $s =~ s,Č,C,g;
    $s =~ s,Đ,D,g;
    $s =~ s,Ł,L,g;
    $s =~ s,Ś,S,g;
    $s =~ s,Š,S,g;
    $s =~ s,Ź,Z,g;
    $s =~ s,Ż,Z,g;
    $s =~ s,ć,c,g;
    $s =~ s,č,c,g;
    $s =~ s,đ,d,g;
    $s =~ s,ę,e,g;
    $s =~ s,ł,l,g;
    $s =~ s,ń,n,g;
    $s =~ s,ą,q,g;
    $s =~ s,ś,s,g;
    $s =~ s,š,s,g;
    $s =~ s,Ź,z,g;
    $s =~ s,ź,z,g;
    $s =~ s,ż,z,g;
    $s =~ s,Ž,z,g;
    $s =~ s,ž,z,g;

    push( @list, $s ) if $s ne $string;

    ############################################
    # spanish
    $s = $string;

    $s =~ s,À,A,g;
    $s =~ s,Ò,o,g;
    $s =~ s,à,a,g;
    $s =~ s,á,a,g;
    $s =~ s,ç,c,g;
    $s =~ s,è,e,g;
    $s =~ s,é,e,g;
    $s =~ s,ë,e,g;
    $s =~ s,ì,i,g;
    $s =~ s,í,i,g;
    $s =~ s,ï,i,g;
    $s =~ s,ñ,n,g;
    $s =~ s,ò,o,g;
    $s =~ s,ó,o,g;
    $s =~ s,ú,u,g;
    $s =~ s,ü,u,g;

    push( @list, $s ) if $s ne $string;

    ############################################
    # danish
    $s = $string;

    $s =~ s,Å,A,g;
    $s =~ s,Æ,A,g;
    $s =~ s,Ø,O,g;
    $s =~ s,ä,a,g;
    $s =~ s,å,a,g;
    $s =~ s,æ,a,g;
    $s =~ s,é,e,g;
    $s =~ s,ø,o,g;

    push( @list, $s ) if $s ne $string;

    ############################################
    # Cyrillic
    $s = $string;

    s,А,A,g;
    s,а,a,g;
    s,Б,B,g;
    s,б,b,g;
    s,В,V,g;
    s,в,v,g;
    s,Ѓ,Ǵ,g;
    s,ѓ,ǵ,g;
    s,Д,D,g;
    s,д,d,g;
    s,Ђ,Đ,g;
    s,ђ,đ,g;
    s,Е,E,g;
    s,е,e,g;
    s,Ё,Ë,g;
    s,ё,ë,g;
    s,Ж,Ž,g;
    s,ж,ž,g;
    s,З,Z,g;
    s,з,z,g;
    s,И,I,g;
    s,и,i,g;
    s,Й,J,g;
    s,й,j,g;
    s,К,K,g;
    s,к,k,g;
    s,Л,L,g;
    s,л,l,g;
    s,М,M,g;
    s,м,m,g;
    s,Н,N,g;
    s,н,n,g;
    s,О,O,g;
    s,о,o,g;
    s,П,P,g;
    s,п,p,g;
    s,Р,R,g;
    s,р,r,g;
    s,С,S,g;
    s,с,s,g;
    s,Т,T,g;
    s,т,t,g;
    s,Ќ,Ḱ,g;
    s,ќ,ḱ,g;
    s,Ћ,Ć,g;
    s,ћ,ć,g;
    s,У,U,g;
    s,у,u,g;
    s,Ў,Ǔ,g;
    s,ў,ŭ,g;
    s,Ф,F,g;
    s,ф,f,g;
    s,Ц,C,g;
    s,ц,c,g;
    s,Ч,Č,g;
    s,ч,č,g;
    s,Ш,Š,g;
    s,ш,š,g;
    s,Ь,′,g;
    s,ь,,g;
    s,Ѣ,Ě,g;
    s,ѣ,ě,g;
    push( @list, $s ) if $s ne $string;

    # return unique list
    my %hash = map { $_ => 1 } @list;
    @list = keys %hash;

    return @list;
}

sub usage {
    warn
"usage: [--input-charset=iso-8859-1] < data/strassen > data/opensearch.streetnames\n";
    warn "       [--debug=0..2] [--help]\n";
    exit(1);
}

my $debug    = 0;
my $icharset = 'utf8';
my $help;

my $rc = GetOptions(
    "debug=i"         => \$debug,
    "input-charset=s" => \$icharset,
    "help"            => \$help,
);

&usage if !$rc || $help;

binmode( \*STDIN,  ":encoding($icharset)" ) or die "binmode: $!\n";
binmode( \*STDOUT, ":encoding(utf8)" )      or die "binmode: $!\n";

my %s;
while (<STDIN>) {
    if ( /^\s*#/ || /^\(/ ) {
        next;
    }

    chomp;
    my $street = ( split(/\t/) )[0];
    $s{$street} = 1 if $street;
}

foreach my $street ( sort keys %s ) {
    if ( my @strings = unicode2ascii($street) ) {
        foreach my $s (@strings) {
            print $s, "\t", $street, "\n";
        }
    }
    else {
        print "$street\n";
    }
}

