###############################################################
# Wolfram Schneider, Aug 2008
#
# Get and convert OpenStreetMap.org data to BBBike
#
# For more information about BBBike, visit http://www.bbbike.de
#
# $Id: Makefile.osm,v 1.43 2009/02/15 11:43:54 wosch Exp $


OSMBIKE_DATA=	data-osm.tgz
DOWNLOADOSM=	./miscsrc/downloadosm --debug=0 --step=0.02
OSM2BBD=	./miscsrc/osm2bbd --debug=0 -f -map bbbike

OSM_DIR=	osm
DATA_OSM_DIR=	data-osm
CITIES=		\
	Amsterdam \
	Austin \
	Basel \
	Cambridge \
	Cracow \
	Colmar \
	Copenhagen \
	Erlangen \
	Freiburg \
	Hannover \
	Karlsruhe \
	Laibach \
	New_york \
	Portland \
	San_francisco \
	Santa_cruz \
	Toronto \
	Wien \
	Zuerich \
	Aachen \
	Bielefeld \
	Bonn \
	Bremen \
	Dresden \
	Duesseldorf \
	Erfurt \
	Frankfurt \
	Goettingen \
	Hamburg \
	Jena \
	Koeln \
	Leipzig \
	Luebeck \
	Mainz \
	Muenster \
	Rostock \
	Strassburg


all: help

tarball: green-ways berlin-coord
	rm -f data-osm/*/meta.*
	@for i in data-osm/*; do (cd $$i && touch ubahn ubahnhof sbahn sbahnhof rbahn rbahnhof Berlin.coords.data Potsdam.coords.data); done # workaround for bug in osm2bbd
	tar cf - data-osm | gzip > ${OSMBIKE_DATA}

green-ways:
	for i in data-osm/*; do (cd $$i && perl -npe 's/^\s/XYZ\t/; s/RW1/green2/g' radwege_exact > green); done

berlin-coord:
	for i in data-osm/*; do \
	  (cd $$i && \
	  perl -nle '($$name,$$coord) = $$_ =~ m{^([^\t]+)\t\S+\s+(\S+)}; if ($$name) { print "$$name|||$$coord" } ' strassen | \
	  perl -e 'binmode(\*STDOUT, ":encoding(iso-8859-1)"); binmode(\*STDIN, ":utf8"); while(<>) {print}' > Berlin.coords.data ); \
	done

cities: 
	${MAKE} -f Makefile.osm ${CITIES}

convert: 
	mkdir -p data-osm
	for i in ${CITIES}; do ${MAKE} -f Makefile.osm "$$i"-convert & done; wait

# bbbike @ Copenhagen
Copenhagen: Copenhagen-download Copenhagen-convert
Copenhagen-download: 
	mkdir -p ${OSM_DIR}/Copenhagen
	${DOWNLOADOSM} -o ${OSM_DIR}/Copenhagen -- 12.275 55.549 12.702 55.831
Copenhagen-convert:
	${OSM2BBD} -centerdelta 12.44,55.56 -o ${DATA_OSM_DIR}/Copenhagen ${OSM_DIR}/Copenhagen

# bbbike @ Karlsruhe
Karlsruhe: Karlsruhe-download Karlsruhe-convert
Karlsruhe-download:
	mkdir -p ${OSM_DIR}/Karlsruhe
	${DOWNLOADOSM} -o ${OSM_DIR}/Karlsruhe -- 8.295 48.964 8.478 49.126
Karlsruhe-convert:
	${OSM2BBD} -centerdelta 8.275,48.894 -o ${DATA_OSM_DIR}/Karlsruhe ${OSM_DIR}/Karlsruhe

# bbbike @ San Francisco
San_francisco: San_francisco-download San_francisco-convert
San_francisco-download:
	mkdir -p ${OSM_DIR}/San_Francisco
	${DOWNLOADOSM} -o ${OSM_DIR}/San_Francisco -- -122.527 37.594 -122.351 37.811
San_francisco-convert:
	${OSM2BBD} -centerdelta -122.55,37.67 -o ${DATA_OSM_DIR}/San_Francisco ${OSM_DIR}/San_Francisco

# bbbike @ Santa Cruz
Santa_cruz: Santa_cruz-download Santa_cruz-convert
Santa_cruz-download:
	mkdir -p ${OSM_DIR}/Santa_Cruz
	${DOWNLOADOSM} -o ${OSM_DIR}/Santa_Cruz -- -122.087 36.941 -121.917 37.013
Santa_cruz-convert:
	${OSM2BBD} -centerdelta -122.12,36.845 -o ${DATA_OSM_DIR}/Santa_Cruz ${OSM_DIR}/Santa_Cruz

# bbbike @ Basel
Basel: Basel-download Basel-convert
Basel-download:
	mkdir -p ${OSM_DIR}/Basel
	${DOWNLOADOSM} -o ${OSM_DIR}/Basel -- 7.5298 47.5128 7.6823 47.5943
Basel-convert:
	${OSM2BBD} -centerdelta 7.47,47.44 -o ${DATA_OSM_DIR}/Basel ${OSM_DIR}/Basel


# bbbike @ Amsterdam
Amsterdam: Amsterdam-download Amsterdam-convert
Amsterdam-download:
	mkdir -p ${OSM_DIR}/Amsterdam
	${DOWNLOADOSM} -o ${OSM_DIR}/Amsterdam -- 4.7982 52.3206 5.0265 52.4309
Amsterdam-convert:
	${OSM2BBD} -centerdelta 4.77,52.25 -o ${DATA_OSM_DIR}/Amsterdam ${OSM_DIR}/Amsterdam

# bbbike @ Erlangen
Erlangen: Erlangen-download Erlangen-convert
Erlangen-download:
	mkdir -p ${OSM_DIR}/Erlangen
	${DOWNLOADOSM} -o ${OSM_DIR}/Erlangen -- 10.9636 49.5208 11.0606 49.6199
Erlangen-convert:
	${OSM2BBD} -centerdelta 10.87,49.48 -o ${DATA_OSM_DIR}/Erlangen ${OSM_DIR}/Erlangen

# bbbike @ Freiburg
Freiburg: Freiburg-download Freiburg-convert
Freiburg-download:
	mkdir -p ${OSM_DIR}/Freiburg
	${DOWNLOADOSM} -o ${OSM_DIR}/Freiburg -- 7.7758 47.9677 7.9087 48.0393
Freiburg-convert:
	${OSM2BBD} -centerdelta 7.73,47.88 -o ${DATA_OSM_DIR}/Freiburg ${OSM_DIR}/Freiburg

# bbbike @ Hannover
Hannover: Hannover-download Hannover-convert
Hannover-download:
	mkdir -p ${OSM_DIR}/Hannover
	${DOWNLOADOSM} -o ${OSM_DIR}/Hannover -- 9.583 52.308 9.92 52.473
Hannover-convert:
	${OSM2BBD} -centerdelta 9.61,52.25 -o ${DATA_OSM_DIR}/Hannover ${OSM_DIR}/Hannover

# bbbike @ Colmar
Colmar: Colmar-download Colmar-convert
Colmar-download:
	mkdir -p ${OSM_DIR}/Colmar
	${DOWNLOADOSM} -o ${OSM_DIR}/Colmar -- 7.305 48.0471 7.4086 48.1236
Colmar-convert:
	${OSM2BBD} -centerdelta 7.23,47.96 -o ${DATA_OSM_DIR}/Colmar ${OSM_DIR}/Colmar

# bbbike @ Zuerich
Zuerich: Zuerich-download Zuerich-convert
Zuerich-download:
	mkdir -p ${OSM_DIR}/Zuerich
	${DOWNLOADOSM} -o ${OSM_DIR}/Zuerich -- 8.4483 47.3437 8.6271 47.4185
Zuerich-convert:
	${OSM2BBD} -centerdelta 8.41,47.25 -o ${DATA_OSM_DIR}/Zuerich ${OSM_DIR}/Zuerich


# bbbike @ Portland
Portland: Portland-download Portland-convert
Portland-download:
	mkdir -p ${OSM_DIR}/Portland
	#${DOWNLOADOSM} -o ${OSM_DIR}/Portland -- -122.99 45.74 -122.37 45.34
	${DOWNLOADOSM} -o ${OSM_DIR}/Portland -- -122.81 45.43 -122.53 45.59
Portland-convert:
	${OSM2BBD} -centerdelta -122.80,45.40 -o ${DATA_OSM_DIR}/Portland ${OSM_DIR}/Portland

# bbbike @ Wien
Wien: Wien-download Wien-convert
Wien-download:
	mkdir -p ${OSM_DIR}/Wien
	${DOWNLOADOSM} -o ${OSM_DIR}/Wien -- 16.2779 48.1592 16.4976 48.2636
Wien-convert:
	${OSM2BBD} -centerdelta 16.24,48.09 -o ${DATA_OSM_DIR}/Wien ${OSM_DIR}/Wien

# bbbike @ Laibach
Laibach: Laibach-download Laibach-convert
Laibach-download:
	mkdir -p ${OSM_DIR}/Laibach
	${DOWNLOADOSM} -o ${OSM_DIR}/Laibach -- 14.43 46.01 14.64 46.13
Laibach-convert:
	${OSM2BBD} -centerdelta 14.39,45.93 -o ${DATA_OSM_DIR}/Laibach ${OSM_DIR}/Laibach

# bbbike @ Cracow
Cracow: Cracow-download Cracow-convert
Cracow-download:
	mkdir -p ${OSM_DIR}/Cracow
	${DOWNLOADOSM} -o ${OSM_DIR}/Cracow -- 19.88 50.02 20.00 50.09
Cracow-convert:
	${OSM2BBD} -centerdelta 19.82,49.94 -o ${DATA_OSM_DIR}/Cracow ${OSM_DIR}/Cracow

# bbbike @ Cambridge
Cambridge: Cambridge-download Cambridge-convert
Cambridge-download:
	mkdir -p ${OSM_DIR}/Cambridge
	${DOWNLOADOSM} -o ${OSM_DIR}/Cambridge -- 0.0593 52.1708 0.2018 52.2577
Cambridge-convert:
	${OSM2BBD} -centerdelta 0.00,52.085 -o ${DATA_OSM_DIR}/Cambridge ${OSM_DIR}/Cambridge

rsync-source:
	rsync -azv -C --exclude osm   --safe-links  $$HOME/projects/bbbike/ srand.de:/usr/local/www/srand.de/bbbike
	rsync -azv -C --exclude osm   --safe-links  $$HOME/projects/bbbike/ elsif.de:/usr/local/www/elsif.de/bbbike

# bbbike @ Austin
Austin: Austin-download Austin-convert
Austin-download:
	mkdir -p ${OSM_DIR}/Austin
	${DOWNLOADOSM} -o ${OSM_DIR}/Austin -- -97.798 30.216 -97.675 30.316
Austin-convert:
	${OSM2BBD} -centerdelta -97.87,30.15 -o ${DATA_OSM_DIR}/Austin ${OSM_DIR}/Austin

# bbbike @ New York
New_york: New_york-download New_york-convert
New_york-download:
	mkdir -p ${OSM_DIR}/New_York
	${DOWNLOADOSM} -o ${OSM_DIR}/New_York -- -74.063 40.67 -73.894 40.827
New_york-convert:
	${OSM2BBD} -centerdelta -74.12,40.59 -o ${DATA_OSM_DIR}/New_York ${OSM_DIR}/New_York

# bbbike @ Toronto
Toronto: Toronto-download Toronto-convert
Toronto-download:
	mkdir -p ${OSM_DIR}/Toronto
	${DOWNLOADOSM} -o ${OSM_DIR}/Toronto -- -79.674 43.602 -79.077 43.849
Toronto-convert:
	${OSM2BBD} -centerdelta -79.674,43.602 -o ${DATA_OSM_DIR}/Toronto ${OSM_DIR}/Toronto


##############################################################################################
# bbbike @ Aachen
Aachen: Aachen-download Aachen-convert
Aachen-download:
	mkdir -p ${OSM_DIR}/Aachen
	${DOWNLOADOSM} -o ${OSM_DIR}/Aachen -- 6.0388 50.7388 6.1549 50.8076
Aachen-convert:
	${OSM2BBD} -centerdelta 6.03,50.73 -o ${DATA_OSM_DIR}/Aachen ${OSM_DIR}/Aachen

# bbbike @ Bielefeld
Bielefeld: Bielefeld-download Bielefeld-convert
Bielefeld-download:
	mkdir -p ${OSM_DIR}/Bielefeld
	${DOWNLOADOSM} -o ${OSM_DIR}/Bielefeld -- 8.399 51.946 8.657 52.071
Bielefeld-convert:
	${OSM2BBD} -centerdelta 8.39,51.94 -o ${DATA_OSM_DIR}/Bielefeld ${OSM_DIR}/Bielefeld

# bbbike @ Bonn
Bonn: Bonn-download Bonn-convert
Bonn-download:
	mkdir -p ${OSM_DIR}/Bonn
	${DOWNLOADOSM} -o ${OSM_DIR}/Bonn -- 6.971 50.621 7.289 50.813
Bonn-convert:
	${OSM2BBD} -centerdelta 6.97,50.62 -o ${DATA_OSM_DIR}/Bonn ${OSM_DIR}/Bonn

# bbbike @ Bremen
Bremen: Bremen-download Bremen-convert
Bremen-download:
	mkdir -p ${OSM_DIR}/Bremen
	${DOWNLOADOSM} -o ${OSM_DIR}/Bremen -- 8.704 53.007 9.001 53.137
Bremen-convert:
	${OSM2BBD} -centerdelta 8.70,53.00 -o ${DATA_OSM_DIR}/Bremen ${OSM_DIR}/Bremen

# bbbike @ Dresden
Dresden: Dresden-download Dresden-convert
Dresden-download:
	mkdir -p ${OSM_DIR}/Dresden
	${DOWNLOADOSM} -o ${OSM_DIR}/Dresden -- 13.61 50.97 13.922 51.119
Dresden-convert:
	${OSM2BBD} -centerdelta 13.61,50.97 -o ${DATA_OSM_DIR}/Dresden ${OSM_DIR}/Dresden

# bbbike @ Duesseldorf
Duesseldorf: Duesseldorf-download Duesseldorf-convert
Duesseldorf-download:
	mkdir -p ${OSM_DIR}/Duesseldorf
	${DOWNLOADOSM} -o ${OSM_DIR}/Duesseldorf -- 6.637 51.145 6.959 51.295
Duesseldorf-convert:
	${OSM2BBD} -centerdelta 6.637,51.145 -o ${DATA_OSM_DIR}/Duesseldorf ${OSM_DIR}/Duesseldorf

# bbbike @ Erfurt
Erfurt: Erfurt-download Erfurt-convert
Erfurt-download:
	mkdir -p ${OSM_DIR}/Erfurt
	${DOWNLOADOSM} -o ${OSM_DIR}/Erfurt -- 10.969 50.9454 11.0991 51.0087
Erfurt-convert:
	${OSM2BBD} -centerdelta 10.969,50.9454 -o ${DATA_OSM_DIR}/Erfurt ${OSM_DIR}/Erfurt

# bbbike @ Frankfurt
Frankfurt: Frankfurt-download Frankfurt-convert
Frankfurt-download:
	mkdir -p ${OSM_DIR}/Frankfurt
	${DOWNLOADOSM} -o ${OSM_DIR}/Frankfurt -- 8.44 50.02 8.979 50.185
Frankfurt-convert:
	${OSM2BBD} -centerdelta 8.66,50.10 -o ${DATA_OSM_DIR}/Frankfurt ${OSM_DIR}/Frankfurt

# bbbike @ Goettingen
Goettingen: Goettingen-download Goettingen-convert
Goettingen-download:
	mkdir -p ${OSM_DIR}/Goettingen
	${DOWNLOADOSM} -o ${OSM_DIR}/Goettingen -- 9.8519 51.494 9.9917 51.5818
Goettingen-convert:
	${OSM2BBD} -centerdelta 9.8519,51.494 -o ${DATA_OSM_DIR}/Goettingen ${OSM_DIR}/Goettingen

# bbbike @ Hamburg
Hamburg: Hamburg-download Hamburg-convert
Hamburg-download:
	mkdir -p ${OSM_DIR}/Hamburg
	${DOWNLOADOSM} -o ${OSM_DIR}/Hamburg -- 9.77 53.426 10.24 53.663
Hamburg-convert:
	${OSM2BBD} -centerdelta 9.77,53.426 -o ${DATA_OSM_DIR}/Hamburg ${OSM_DIR}/Hamburg

# bbbike @ Jena
Jena: Jena-download Jena-convert
Jena-download:
	mkdir -p ${OSM_DIR}/Jena
	${DOWNLOADOSM} -o ${OSM_DIR}/Jena -- 11.5241 50.8597 11.6696 50.9705
Jena-convert:
	${OSM2BBD} -centerdelta 11.52,50.85 -o ${DATA_OSM_DIR}/Jena ${OSM_DIR}/Jena

# bbbike @ Koeln
Koeln: Koeln-download Koeln-convert
Koeln-download:
	mkdir -p ${OSM_DIR}/Koeln
	${DOWNLOADOSM} -o ${OSM_DIR}/Koeln -- 6.823 50.865 7.108 51.015
Koeln-convert:
	${OSM2BBD} -centerdelta 6.82,50.86 -o ${DATA_OSM_DIR}/Koeln ${OSM_DIR}/Koeln

# bbbike @ Leipzig
Leipzig: Leipzig-download Leipzig-convert
Leipzig-download:
	mkdir -p ${OSM_DIR}/Leipzig
	${DOWNLOADOSM} -o ${OSM_DIR}/Leipzig -- 12.271 51.27 12.502 51.4
Leipzig-convert:
	${OSM2BBD} -centerdelta 12.27,51.27 -o ${DATA_OSM_DIR}/Leipzig ${OSM_DIR}/Leipzig

# bbbike @ Luebeck
Luebeck: Luebeck-download Luebeck-convert
Luebeck-download:
	mkdir -p ${OSM_DIR}/Luebeck
	${DOWNLOADOSM} -o ${OSM_DIR}/Luebeck -- 10.574 53.82 10.806 53.933
Luebeck-convert:
	${OSM2BBD} -centerdelta 10.57,53.82 -o ${DATA_OSM_DIR}/Luebeck ${OSM_DIR}/Luebeck

# bbbike @ Mainz
Mainz: Mainz-download Mainz-convert
Mainz-download:
	mkdir -p ${OSM_DIR}/Mainz
	${DOWNLOADOSM} -o ${OSM_DIR}/Mainz -- 8.1339 49.9325 8.4123 50.1077
Mainz-convert:
	${OSM2BBD} -centerdelta 8.13,49.93 -o ${DATA_OSM_DIR}/Mainz ${OSM_DIR}/Mainz

# bbbike @ Muenster
Muenster: Muenster-download Muenster-convert
Muenster-download:
	mkdir -p ${OSM_DIR}/Muenster
	${DOWNLOADOSM} -o ${OSM_DIR}/Muenster -- 7.5771 51.9226 7.6873 51.9917
Muenster-convert:
	${OSM2BBD} -centerdelta 7.57,51.92 -o ${DATA_OSM_DIR}/Muenster ${OSM_DIR}/Muenster

# bbbike @ Rostock
Rostock: Rostock-download Rostock-convert
Rostock-download:
	mkdir -p ${OSM_DIR}/Rostock
	${DOWNLOADOSM} -o ${OSM_DIR}/Rostock -- 12.0204 54.0599 12.2271 54.1933
Rostock-convert:
	${OSM2BBD} -centerdelta 12.02,54.05 -o ${DATA_OSM_DIR}/Rostock ${OSM_DIR}/Rostock

# bbbike @ Strassburg
Strassburg: Strassburg-download Strassburg-convert
Strassburg-download:
	mkdir -p ${OSM_DIR}/Strassburg
	${DOWNLOADOSM} -o ${OSM_DIR}/Strassburg -- 7.6515 48.5189 7.875 48.6525
Strassburg-convert:
	${OSM2BBD} -centerdelta 7.65,48.51 -o ${DATA_OSM_DIR}/Strassburg ${OSM_DIR}/Strassburg

##############################################################################################


scp rsync:
	rsync -av ${OSMBIKE_DATA} wolfram.schneider.org:www/src/bbbike

clean:
	rm -rf data-osm
	mkdir data-osm

dist-clean devel-clean distclean: clean
	rm -rf osm
	mkdir -p osm

help:
	@echo "usage: make [ help | cities | convert | rsync | rsync-source | tarball | clean | dist-clean ]"
	@echo "usage: make [ ${CITIES} ]"

